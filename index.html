<!DOCTYPE html>
<html>
<head>
	<!-- <script lang="javascript" src="assets/js/jquery-3.1.0.min.js"></script> -->
	<script lang="javascript" src="assets/js/d3.v4.min.js"></script>
	<link rel="stylesheet" href="assets/css/bar.css"/>
	<style>
		svg { font:10px sans-serif; }
		rect { stroke: #fff; }
	</style>
</head>
<body>
	<svg id="barchart"></svg>


	<script>

	d3.queue()
	  .defer(d3.csv, "/assets/data/mass_shootings.csv")
	  .await(ready);

	function ready(error, data) {
		if (error) { console.log(error); }

		console.log(data[100])
		yearly = getYearlyVictims(data)
	  
		var svgWidth = 1000;
		var svgHeight = 500;
		var svg = d3.select('svg')
		    .attr("width", svgWidth)
		    .attr("height", svgHeight)
		    .attr("class", "bar-chart");

		// arbitrary bar graph for reference
		var dataset = [80, 100, 56, 120, 180, 30, 40, 120, 160];
		var barPadding = 5;
		var barWidth = (svgWidth / dataset.length);
		var barChart = svg.selectAll("rect")
		    .data(dataset)
		    .enter()
		    .append("rect")
		    .attr("y", function(d) {
		        return svgHeight - d
		    })
		    .attr("height", function(d) {
		        return d;
		    })
		    .attr("width", barWidth - barPadding)
		    .attr("transform", function (d, i) {
		         var translate = [barWidth * i, 0];
		         return "translate("+ translate +")";
		    });
	}

	function getYearlyVictims(data) {
		let yearlyVictims = {}
		data.forEach(function(element) {
			let year = (new Date(element["date"])).getFullYear()
			if (year in yearlyVictims) {
				yearlyVictims[year] += Number(element["total_victims"])
			} else {
				yearlyVictims[year] = Number(element["total_victims"])
			}
		})
		console.log(yearlyVictims)
		return yearlyVictims
	}

	</script>

</body>
</html>