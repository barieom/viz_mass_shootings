<!DOCTYPE html>
<html>
<head>
	<!-- <script lang="javascript" src="assets/js/jquery-3.1.0.min.js"></script> -->
	<script lang="javascript" src="assets/js/d3.v4.min.js"></script>
	<link rel="stylesheet" href="assets/css/bar.css"/>
	<style>
		svg { font:10px sans-serif; }
		rect { stroke: #fff; }
	</style>
</head>
<body>
	<!-- <svg id="barchart"></svg> -->

	<script>

	// set the dimensions and margins of the graph
	var margin = {top: 20, right: 20, bottom: 30, left: 40},
	    width = 960 - margin.left - margin.right,
	    height = 500 - margin.top - margin.bottom;

	// set the ranges
	var x = d3.scaleBand()
	          .range([0, width])
	          .padding(0.1);
	var y = d3.scaleLinear()
	          .range([height, 0]);

	// https://bl.ocks.org/d3noob/bdf28027e0ce70bd132edc64f1dd7ea4
	          
	// append the svg object to the body of the page
	// append a 'group' element to 'svg'
	// moves the 'group' element to the top left margin
	var svg = d3.select("body").append("svg")
	    .attr("width", width + margin.left + margin.right)
	    .attr("height", height + margin.top + margin.bottom)
	  .append("g")
	    .attr("transform", 
	          "translate(" + margin.left + "," + margin.top + ")");

	d3.queue()
	  .defer(d3.csv, "/assets/data/mass_shootings.csv")
	  .await(ready);

	function ready(error, data) {
		if (error) { console.log(error); }

		console.log(data[100])
		yearly = getYearlyVictims(data)

		// Scale the range of the data in the domains
		// x.domain(data.map(function(d) { return d.salesperson; }));
		// y.domain([0, d3.max(data, function(d) { return d.sales; })]);
	  

		// arbitrary bar graph for reference
		// var dataset = [80, 100, 56, 120, 180, 30, 40, 120, 160];
		// var barPadding = 5;
		// var barWidth = (svgWidth / dataset.length);
		// var barChart = svg.selectAll("rect")
		//     .data(dataset)
		//     .enter()
		//     .append("rect")
		//     .attr("y", function(d) {
		//         return svgHeight - d
		//     })
		//     .attr("height", function(d) {
		//         return d;
		//     })
		//     .attr("width", barWidth - barPadding)
		//     .attr("transform", function (d, i) {
		//          var translate = [barWidth * i, 0];
		//          return "translate("+ translate +")";
		// });
	}

	function getYearlyVictims(data) {
		let yearlyVictims = {}
		data.forEach(function(element) {
			let year = (new Date(element["date"])).getFullYear()
			if (year in yearlyVictims) {
				yearlyVictims[year] += Number(element["total_victims"])
			} else {
				yearlyVictims[year] = Number(element["total_victims"])
			}
		})
		console.log(yearlyVictims)
		return yearlyVictims
	}

	</script>

</body>
</html>